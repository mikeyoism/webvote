jQuery(document).ready(function(b){var a=b("#statusdiv");b(".error").hide();votejs.init();a.hide();b("#vote_code").on("keyup focusout",function(d){var c=b(this).val();if(d.type=="keyup"&&c.length<votejs.VOTE_CODE_LEN){return false}else{if(d.type=="focusout"&&c.length<votejs.VOTE_CODE_LEN){a.html('<div class="infobar infobar-warning" data-mini="true">Kod har fel antal tecken!</div>');a.fadeIn()}else{votejs.preCodeCheck()}}return false});b(".voteform_trigger").on("submit",function(c){c.preventDefault();votejs.postvotes(0);return false});b(function(){b("input[type=submit], a, button, input").button().css({"text-align":"left",outline:"none",cursor:"auto"})})});votejs=function(){var h=false;var c=0;var k=true;var p=0;var e=false;var g=3;var q=false;var n=9999;var d=null;var s=[];var j="";function f(){$.ajax({type:"POST",url:"./php/jssettings.php",dataType:"json",cache:false,async:false,data:{operation:"getjssettings",source:"index.php",subset:""},success:function(u){if(u.msgtype=="ok"){h=u.CONST_SYS_JS_DEBUG;q=u.REQUEST_SYSSTATUS;n=u.SETTING_SYSSTATUS_INTERVAL;g=u.CONST_SETTING_VOTE_CODE_LENGTH;c=u.CONST_SETTING_VOTES_PER_CATEGORY_SAME;k=u.CONST_SETTING_VOTES_PER_CATEGORY_SAME_REQUIRE_ALL;p=u.CONST_SETTING_VOTES_PER_CATEGORY;e=u.CONST_SETTING_VOTES_PER_CATEGORY_REQUIRE_ALL;if(h){console.log(u)}s=u.CONST_SETTING_CATEGORIES_SYS;var v=u.SETTING_COMPETITION_NAME;$("#competition_header").text(v)}else{printInfobar("#statusdiv","warning","serverfel 1-1",true)}},error:function(w,u,v){printInfobar("#statusdiv","warning","serverfel 1-2",true)}})}function b(){var u=false;$.ajax({type:"POST",url:"./php/manreg_ajax.php",dataType:"json",cache:false,data:{operation:"mr_reread",source:"manregp.php",vote_code:$("#vote_code").val()},success:function(v){if(h){console.log(v)}if(v.novotes==null){printInfobar("#statusdiv",v.msgtype,"Dina befintliga röster läses in.");$("#statusdiv").fadeOut(3500)}$.each(s,function(w,x){for(i=1;i<=p;i++){$("#"+x+"_vote"+i).val(v["vote_"+i+"_"+x])}})},error:function(x,v,w){if(h){alert("serverfel 1-3, reread: "+v+x+w)}}});return u}function m(u){if(q==true){$.ajax({type:"POST",url:"./php/vote_ajax.php",dataType:"json",cache:false,data:{operation:"sysstatus",source:"index.php",my_interval:n},success:function(v){if(h){console.log(v)}if(v.msgtype=="interval"&&d!=null){clearInterval(d);n=v.interval;d=window.setInterval(m,v.interval)}else{if(v.msgtype=="stop"){$("#sysbar").hide();q=false}else{if(v.usrmsg.length>0){printInfobar("#sysbar",v.msgtype,v.usrmsg)}else{$("#sysbar").hide()}}}},error:function(x,v,w){}})}}function a(){$.ajax({type:"POST",url:"./php/manreg_ajax.php",dataType:"json",cache:false,data:{operation:"mr_pre_codecheck",source:"manreg.php",vote_code:$("#vote_code").val()},success:function(u){if(h){console.log(u)}if(u.msgtype=="ok"){if(j!=$("#vote_code").val()){$("#vote_code").val(u.vote_code);j=$("#vote_code").val();t(true);$("#statusdiv").hide();b()}}else{if(u.usrmsg!=null){printInfobar("#statusdiv",u.msgtype,u.usrmsg);j=""}}},error:function(w,u,v){if(h){alert("serverfel 1-4, preCodeCheck: "+u+w+v)}}})}function t(v){if(!v){$("#vote_code").val("");j=""}var u=$("#voteregform");$("div.vote_category",u).each(function(){var w=$(this).attr("id");var x=1;$("li",$(this)).each(function(){var y=$(this).find("input");if(y!=null){y.val("")}})});$("#vote_code").focus()}function l(){var w=$("#vote_code").val();var y=[];var x=0;var v=$("#voteregform");$("div.vote_category",v).each(function(){var z=$(this).attr("id");var A=1;$("li",$(this)).each(function(){var C=$(this).find("input");if(C!=null){var B=C.val();x++;var D="vote_"+A+++"_"+z;y.push({voteid:D,vote:B})}})});var u={vote_code:w,operation:"mr_post_votes_public",source:"manreg.php"};$.each(y,function(A,z){u[z.voteid]=z.vote});return u}function o(x){var w=$(this);var v=$("#vote_code").val();var y=$(".formstatus_trigger",w);var u=l();u.confirmed_error=x;$.ajax({type:"POST",url:"./php/manreg_ajax.php",dataType:"json",cache:false,data:u,success:function(A){if(h){console.log(A)}var C=$("#form_submit_status");var z=A.usrmsg.replace("\n","<br>");var B=A.msgtype;if(z.length>0&&(B=="warning"||B=="error")){z='<div class="infobar infobar-neutral" style=" margin-bottom: 1em"><b>Fel upptäckta. Försök igen. <br>Felen visas nedan:</div>'+z;$(C).html('<div class="infobar infobar-warning" data-mini="true">'+z+"</div>");if($(C).is(":visible")){$(C).fadeOut()}$(C).fadeIn()}else{$(C).html('<div class="infobar infobar-ok" data-mini="true">'+z+"</div>");$(C).fadeIn().delay(300).fadeOut(3000);t()}},error:function(B,z,A){if(h){console.log("error, post_vote:"+B+","+z+","+A)}y.html("serverfel 1-5: "+z);y.fadeToggle()}})}function r(){f();t();d=window.setInterval(m,n);m()}return{init:r,preCodeCheck:a,postvotes:o}}();