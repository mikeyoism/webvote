$(document).on("pageinit","#votepage",function(c){var b=$("#statusdiv");var d=$("#sysbar");d.hide();$(".error").hide();$("#vote_code").focus();if(supports_html5_storage()){var a=localStorage.vote_code;if(a!=""){$("#vote_code").val(a)}}votejs.init();$("#vote_code").on("keyup",function(h){var g=$(this).val();if(g.length<votejs.VOTE_CODE_LEN){b.html('<div class="infobar infobar-neutral" data-mini="true">Välkommen! ange först din röstkod.</div>');return false}else{var f="<img src='js/loading.gif'  alt='loading...' />";b.html(f);votejs.reread()}return false});$("#statform_trigger").on("submit",function(f){f.preventDefault();$(".error").hide();votejs.statFormEval(this)});$(".voteform_trigger").on("submit",function(f){f.preventDefault();$(".error").hide();votejs.voteFormEval(this)})});function supports_html5_storage(){try{return"localStorage" in window&&window.localStorage!==null}catch(a){return false}}function printInfobar(c,b,a){if(a.length>0){if(b=="ok"||b=="ok-cached"){$(c).html('<div class="infobar infobar-ok" data-mini="true">'+a+"</div>")}else{if(b=="neutral"){$(c).html('<div class="infobar infobar-neutral" data-mini="true">'+a+"</div>")}else{if(b=="warning"){$(c).html('<div class="infobar infobar-warning" data-mini="true">'+a+"</div>")}else{if(b=="error"){$(c).html('<div class="infobar infobar-error" data-mini="true">'+a+"</div>")}}}}$(c).show()}}votejs=function(){var e=false;var l=true;var n=0;var c=true;var b=0;var g=false;var h=3;var d=false;var q=9999;var m=null;var j=[];function k(){$.ajax({type:"POST",url:"./php/jssettings.php",dataType:"json",cache:false,async:false,data:{operation:"getjssettings",source:"index.php",subset:""},success:function(s){if(s.msgtype=="ok"){e=s.CONST_SYS_JS_DEBUG;l=s.DISABLE_CLIENT_CHECKS;d=s.REQUEST_SYSSTATUS;q=s.SETTING_SYSSTATUS_INTERVAL;h=s.CONST_SETTING_VOTE_CODE_LENGTH;n=s.CONST_SETTING_VOTES_PER_CATEGORY_SAME;c=s.CONST_SETTING_VOTES_PER_CATEGORY_SAME_REQUIRE_ALL;b=s.CONST_SETTING_VOTES_PER_CATEGORY;g=s.CONST_SETTING_VOTES_PER_CATEGORY_REQUIRE_ALL;if(e){console.log(s)}j=s.CONST_SETTING_CATEGORIES_SYS;var t=s.SETTING_COMPETITION_NAME;$("#competition_header").text(t)}else{printInfobar("#statusdiv","warning","serverfel 1-1")}},error:function(u,s,t){printInfobar("#statusdiv","warning","serverfel 1-2")}})}function f(){$.ajax({type:"POST",url:"./php/vote_ajax.php",dataType:"json",cache:false,data:{operation:"reread",source:"index.php",vote_code:$("#vote_code").val()},success:function(s){if(e){console.log(s)}var t=true;if(s.msgtype=="ok"){$("#vote_code").val(s.vote_code);if(supports_html5_storage()){localStorage.vote_code=s.vote_code}t=false}else{if(s.msgtype=="ok-cached"){if(supports_html5_storage()){localStorage.vote_code=s.vote_code}t=false}}if(s.usrmsg!=null){printInfobar("#statusdiv",s.msgtype,s.usrmsg)}$.each(j,function(v,w){for(i=1;i<=b;i++){$("#"+w+"_vote"+i).prop("disabled",t);$("#"+w+"_vote"+i).val(s["vote_"+i+"_"+w])}});$("#submit_stat").prop("disabled",t);var u=$(".error");u.html("");u.hide()},error:function(u,s,t){if(e){alert("serverfel, reread: "+s+u+t)}}})}function p(s){if(d==true){$.ajax({type:"POST",url:"./php/vote_ajax.php",dataType:"json",cache:false,data:{operation:"sysstatus",source:"index.php",my_interval:q},success:function(t){if(e){console.log(t)}if(t.msgtype=="interval"&&m!=null){clearInterval(m);q=t.interval;m=window.setInterval(p,t.interval)}else{if(t.msgtype=="stop"){$("#sysbar").hide();d=false}else{if(t.usrmsg.length>0){printInfobar("#sysbar",t.msgtype,t.usrmsg)}else{$("#sysbar").hide()}}}},error:function(v,t,u){}})}}function a(u){var z=$(u);var H=$("#vote_code").val();var s=$(".vote_category",z).attr("id").toLowerCase();var C=$(".formstatus_trigger",z);var G=[];var y=false;var B=0;$("li",z).each(function(){var J=$(this).find("input");if(J!=null){var v=J.val();if(typeof v!="undefined"){if(v!=null&&v.length!=3&&v.length>0){y=true;var I=$(this).find(".error");if(I!=null){I.html("Tre siffror förväntas");I.slideDown()}else{if(e){console.log("check html, missing an error tag for "+s)}}}else{if(v!=null&&v.length!=0){B++}}G.push(v)}}});if(!l){if(n!=-1||g){var A=G.slice(0);var x=1;var F=1;var D=false;while(A.length>0){var E=A.pop();var w;if(E!=""){while(A.length>0&&(w=A.indexOf(E))!=-1){x++;A.splice(w,1)}if(x>F){F=x}x=1}else{if(g===true){D=true}}}if(D){y=true;C.html("Alla röster måste fyllas i, försök igen");C.fadeToggle()}if(F>n&&n!=-1){y=true;if(n==1){C.html("Du kan bara rösta "+n+" gång på samma öl")}else{C.html("Du kan rösta max "+n+" gånger på samma öl")}C.fadeToggle()}else{if(F>1&&B!=b&&c==true){y=true;C.html("Alla "+b+" röster måste fyllas om du röstar +1 gång på samma öl");C.fadeToggle()}}}}if(y){return false}var t={vote_code:H,category:s,operation:"post_vote",source:"index.php"};$.each(G,function(I,v){t["vote_"+(I+1)]=v});$.ajax({type:"POST",url:"./php/vote_ajax.php",dataType:"html",cache:false,data:t,success:function(v){if(e){console.log(v)}C.html(v);C.fadeToggle()},error:function(J,v,I){if(e){console.log("error, post_vote:"+J+","+v+","+I)}C.html("serverfel: "+v);C.fadeToggle()}});return false}function o(w){var u=$(w);var z=$(".formstatus_trigger",u);var y=$('input[name="stat1"]:checked',u).val();var v=$("#stat2",u).val();var t=$("#stat3",u).val();var x=$('input[name="stat4"]:checked',u).val();var s=$("#vote_code").val();$.ajax({type:"POST",url:"./php/vote_ajax.php",dataType:"html",cache:false,data:{vote_code:s,gender:y,age:v,location:t,firstSM:x,operation:"post_stat",source:"index.php"},success:function(A){if(e){console.log(A)}z.html(A);z.fadeToggle()},error:function(C,A,B){if(e){console.log("error, post_vote:"+C+","+A+","+B)}z.html("serverfel: "+A);z.fadeToggle()}});return false}function r(){k();f();m=window.setInterval(p,q);p()}return{init:r,reread:f,sysstatus:p,voteFormEval:a,statFormEval:o}}();